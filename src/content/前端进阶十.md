---
title: å‰ç«¯è¿›é˜¶ï¼ˆä¹ï¼‰
date: 2021-7-10 21:40:33
categories: IT
tags:
    - ITï¼ŒWeb
toc: true
thumbnail: https://cdn.kunkunzhang.top/svelte.png
---

ã€€ã€€å‰ç«¯è¿›é˜¶ï¼ˆä¹ï¼‰-å¾®åº”ç”¨æ¡†æ¶ã€Svelte

<!--more-->

## qiankun

å®‰è£…

```shell
yarn add qiankun 
npm i qiankun -S
```

æ³¨å†Œå¾®åº”ç”¨å¹¶å¯åŠ¨ï¼š

```javascript
import { registerMicroApps, start } from 'qiankun';

registerMicroApps([
  {
    name: 'react app', // app name registered
    entry: '//localhost:7100',
    container: '#yourContainer',
    activeRule: '/yourActiveRule',
  },
  {
    name: 'vue app',
    entry: { scripts: ['//localhost:7100/main.js'] },
    container: '#yourContainer2',
    activeRule: '/yourActiveRule2',
  },
]);

start();
```

å¾®åº”ç”¨åˆ†ä¸ºæœ‰ `webpack` æ„å»ºå’Œæ—  `webpack` æ„å»ºé¡¹ç›®ï¼Œæœ‰ `webpack` çš„å¾®åº”ç”¨ï¼ˆä¸»è¦æ˜¯æŒ‡ Vueã€Reactã€Angularï¼‰éœ€è¦åšçš„äº‹æƒ…æœ‰ï¼š

1. `public-path.js` æ–‡ä»¶ï¼Œç”¨äºä¿®æ”¹è¿è¡Œæ—¶çš„ `publicPath`ã€‚
2. å¾®åº”ç”¨å»ºè®®ä½¿ç”¨ `history` æ¨¡å¼çš„è·¯ç”±ï¼Œéœ€è¦è®¾ç½®è·¯ç”± `base`ï¼Œå€¼å’Œå®ƒçš„ `activeRule` æ˜¯ä¸€æ ·çš„ã€‚
3. åœ¨å…¥å£æ–‡ä»¶æœ€é¡¶éƒ¨å¼•å…¥ `public-path.js`ï¼Œä¿®æ”¹å¹¶å¯¼å‡ºä¸‰ä¸ªç”Ÿå‘½å‘¨æœŸå‡½æ•°ã€‚
4. ä¿®æ”¹ `webpack` æ‰“åŒ…ï¼Œå…è®¸å¼€å‘ç¯å¢ƒè·¨åŸŸå’Œ `umd` æ‰“åŒ…ã€‚

qiankunå¾®åº”ç”¨çš„åŠ è½½è¿‡ç¨‹

é¦–å…ˆè¯»å– `entry` çš„ HTML æ–‡ä»¶ï¼Œè§£æå…¶ä¸­çš„å†…å®¹ã€‚

æŠ½å– HTML æ–‡ä»¶å†…çš„ JS æ–‡ä»¶è¯·æ±‚ï¼Œä½¿ç”¨é‡æ„åçš„ fetch è¯·æ±‚è¿›è¡Œ JS èµ„æºæ‹‰å–ï¼Œå¹¶ä¸”å¯¹è¿”å›çš„ JS ä»£ç è¿›è¡Œæ²™ç®±éš”ç¦»ï¼Œä¸Šä¸‹æ–‡è®¾ç½®ã€‚

æŠ½å– HTML æ–‡ä»¶å†…çš„ CSS æ–‡ä»¶è¯·æ±‚ï¼Œä½¿ç”¨é‡æ„åçš„ fetch è¯·æ±‚è¿›è¡Œ CSS èµ„æºæ‹‰å–ï¼Œå¹¶ä¸”å¯¹è¿”å›çš„ CSS ä»£ç è¿›è¡Œæ ·å¼æ²™ç®±éš”ç¦»(`shadow DOM`)ã€‚



### react appæ¥å…¥qiankun

åœ¨ `src` ç›®å½•æ–°å¢ `public-path.js`ï¼š

```javascript
if (window.__POWERED_BY_QIANKUN__) {
  __webpack_public_path__ = window.__INJECTED_PUBLIC_PATH_BY_QIANKUN__;
}
```

è®¾ç½® `history` æ¨¡å¼è·¯ç”±çš„ `base`ï¼š

```javascript

```

## Micro App

Micro appæ˜¯äº¬ä¸œå¼€å‘çš„å¾®å‰ç«¯appæ¡†æ¶ï¼Œ2021å¹´7æœˆå¼€æº

qiankun è¿˜æ˜¯æœ‰ä¸€äº›ç¼ºç‚¹çš„ï¼š

- é¡¹ç›®çš„ä¾µå…¥æ€§ä¾ç„¶å¾ˆå¼ºã€‚
- qiankun åœ¨æ²™ç®±æ–¹é¢ä¾ç„¶æœ‰ä¸å°‘å‘ã€‚qiankunåŸºæœ¬ä¸Šéƒ½æ˜¯åœ¨ä¿®å¤æ²™ç®±ç›¸å…³çš„é—®é¢˜

åœ¨`micro-app`ä¹‹å‰ï¼Œä¸šå†…å·²ç»æœ‰ä¸€äº›å¼€æºçš„å¾®å‰ç«¯æ¡†æ¶ï¼Œæ¯”è¾ƒæµè¡Œçš„æœ‰2ä¸ªï¼š`single-spa`å’Œ`qiankun`ã€‚

`single-spa`æ˜¯é€šè¿‡ç›‘å¬ url change äº‹ä»¶ï¼Œåœ¨è·¯ç”±å˜åŒ–æ—¶åŒ¹é…åˆ°æ¸²æŸ“çš„å­åº”ç”¨å¹¶è¿›è¡Œæ¸²æŸ“ï¼Œè¿™ä¸ªæ€è·¯ä¹Ÿæ˜¯ç›®å‰å®ç°å¾®å‰ç«¯çš„ä¸»æµæ–¹å¼ã€‚åŒæ—¶`single-spa`è¦æ±‚å­åº”ç”¨ä¿®æ”¹æ¸²æŸ“é€»è¾‘å¹¶æš´éœ²å‡ºä¸‰ä¸ªæ–¹æ³•ï¼š`bootstrap`ã€`mount`ã€`unmount`ï¼Œåˆ†åˆ«å¯¹åº”åˆå§‹åŒ–ã€æ¸²æŸ“å’Œå¸è½½ï¼Œè¿™ä¹Ÿå¯¼è‡´å­åº”ç”¨éœ€è¦å¯¹å…¥å£æ–‡ä»¶è¿›è¡Œä¿®æ”¹ã€‚å› ä¸º`qiankun`æ˜¯åŸºäº`single-spa`è¿›è¡Œå°è£…ï¼Œæ‰€ä»¥è¿™äº›ç‰¹ç‚¹ä¹Ÿè¢«`qiankun`ç»§æ‰¿ä¸‹æ¥ï¼Œå¹¶ä¸”éœ€è¦å¯¹webpacké…ç½®è¿›è¡Œä¸€äº›ä¿®æ”¹ã€‚

`micro-app`å¹¶æ²¡æœ‰æ²¿è¢­`single-spa`çš„æ€è·¯ï¼Œè€Œæ˜¯å€Ÿé‰´äº†WebComponentçš„æ€æƒ³ï¼Œé€šè¿‡CustomElementç»“åˆè‡ªå®šä¹‰çš„ShadowDomï¼Œå°†å¾®å‰ç«¯å°è£…æˆä¸€ä¸ªç±»WebComponentç»„ä»¶ï¼Œä»è€Œå®ç°å¾®å‰ç«¯çš„ç»„ä»¶åŒ–æ¸²æŸ“ã€‚å¹¶ä¸”ç”±äºè‡ªå®šä¹‰ShadowDomçš„éš”ç¦»ç‰¹æ€§ï¼Œ`micro-app`ä¸éœ€è¦åƒ`single-spa`å’Œ`qiankun`ä¸€æ ·è¦æ±‚å­åº”ç”¨ä¿®æ”¹æ¸²æŸ“é€»è¾‘å¹¶æš´éœ²å‡ºæ–¹æ³•ï¼Œä¹Ÿä¸éœ€è¦ä¿®æ”¹webpacké…ç½®ï¼Œæ˜¯ç›®å‰å¸‚é¢ä¸Šæ¥å…¥å¾®å‰ç«¯æˆæœ¬æœ€ä½çš„æ–¹æ¡ˆã€‚

Micro Appçš„ç‰¹ç‚¹ï¼š

- **ä½¿ç”¨ç®€å•ã€‚** å°†åŠŸèƒ½å°è£…åˆ° WebComponent ä¸­
- **é›¶ä¾èµ–ã€‚** æ— ä¾èµ–ã€æ›´é«˜çš„æ‰©å±•æ€§
- **å…¼å®¹æ‰€æœ‰æ¡†æ¶** æŠ€æœ¯æ ˆæ— å…³

å®‰è£…micro app

```shell
yarn add @micro-zoe/micro-app
```

åœ¨å…¥å£å¤„å¼•å…¥

```javascript
// index.js
import microApp from '@micro-zoe/micro-app'

microApp.start()
```

åˆ†é…ä¸€ä¸ªè·¯ç”±ç»™å­åº”ç”¨

```javascript
// router.js
import { BrowserRouter, Switch, Route } from 'react-router-dom'
import MyPage from './my-page'

export default function AppRoute () {
  return (
    <BrowserRouter>
      <Switch>
        // ğŸ‘‡ éä¸¥æ ¼åŒ¹é…ï¼Œ/my-page/* éƒ½æŒ‡å‘ MyPage é¡µé¢
        <Route path='/my-page'>
          <MyPage />
        </Route>
      </Switch>
    </BrowserRouter>
  )
}
```

åœ¨åº”ç”¨ä¸­åµŒå…¥å­åº”ç”¨

```javascript
// my-page.js
export function MyPage () {
  return (
    <div>
      <h1>å­åº”ç”¨</h1>
      // name(å¿…ä¼ )ï¼šåº”ç”¨åç§°
      // url(å¿…ä¼ )ï¼šåº”ç”¨åœ°å€ï¼Œä¼šè¢«è‡ªåŠ¨è¡¥å…¨ä¸ºhttp://localhost:3000/index.html
      // baseroute(å¯é€‰)ï¼šåŸºåº§åº”ç”¨åˆ†é…ç»™å­åº”ç”¨çš„åŸºç¡€è·¯ç”±ï¼Œå°±æ˜¯ä¸Šé¢çš„ `/my-page`
      <micro-app name='app1' url='http://localhost:3000/' baseroute='/my-page'></micro-app>
    </div>
  )
}
```

å­åº”ç”¨è®¾ç½®åŸºç¡€è·¯ç”±

```javascript
// router.js
import { BrowserRouter, Switch, Route } from 'react-router-dom'

export default function AppRoute () {
  return (
    // ğŸ‘‡ è®¾ç½®åŸºç¡€è·¯ç”±ï¼Œå­åº”ç”¨å¯ä»¥é€šè¿‡window.__MICRO_APP_BASE_ROUTE__è·å–åŸºåº§ä¸‹å‘çš„baserouteï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®baserouteå±æ€§ï¼Œåˆ™æ­¤å€¼é»˜è®¤ä¸ºç©ºå­—ç¬¦ä¸²
    <BrowserRouter basename={window.__MICRO_APP_BASE_ROUTE__ || '/'}>
      ...
    </BrowserRouter>
  )
}
```

åœ¨webpack-dev-serverçš„headersä¸­è®¾ç½®è·¨åŸŸæ”¯æŒ

```javascript
devServer: {
  headers: {
    'Access-Control-Allow-Origin': '*',
  }
},
```

### æ•°æ®é€šä¿¡

æ•°æ®é€šä¿¡ä¹Ÿæ˜¯ `micro-app` çš„ä¸€å¤§äº®ç‚¹ï¼Œåœ¨ä½¿ç”¨å±‚é¢ä¸Šæ¯” `qiankun` çš„ EventBus è¦å¥½ç”¨ä¸€ç‚¹

çˆ¶ä¼ å­

åœ¨åŸºåº§åº”ç”¨çš„å®¹å™¨ç»„ä»¶é‡Œæ·»åŠ ä¸€ä¸ª `microApp.setData` å°±å¥½äº†

```javascript
// ReactMicroApp
const ReactMicroApp = () => {
  const [microAppState, setMicroAppState] = useState(microApp.getData('react-app'));

  // å‘é€æ•°æ®ç»™ react-app
  const sendReactAppData = () => {
    // setDataçš„å€¼å¿…é¡»ä¸ºå¯¹è±¡
    microApp.setData('react-app', {
      name: `react-app éšæœºæ•°: ${Math.random()}`
    })
  }

  return (
    <div>
      <h1>react-app</h1>
      <button onClick={sendReactAppData}>åŸºåº§ => react-app</button>

      <p>å­åº”ç”¨æ¶ˆæ¯ {microAppState ? microAppState.msg : 'æ— '}</p>

      <micro-app
        name='react-app'
        url='http://localhost:3001/'
        baseroute='/react-app'
      >
      </micro-app>
    </div>
  )
}
```

å¾®åº”ç”¨åœ¨æ¥æ”¶æ•°æ®çš„æ—¶å€™ä¹Ÿæ˜¯ä¸€æ ·é€šè¿‡äº‹ä»¶ç›‘å¬addDataListeneræ¥è·å–

```javascript
// react-app App.js
function App() {
  const [mainAppData, setMainAppData] = useState( window.microApp.getData());

  // ç›‘å¬åŸºåº§æ•°æ®
  useEffect(() => {
    if (window.microApp) {
      const dataListener = (data) => {
        console.log('ä¸»åº”ç”¨ä¼ çš„æ•°æ®', data);
        setMainAppData(data);
      }

      window.microApp.addDataListener(dataListener)
      return () => {
        window.microApp.clearDataListener()
      }
    }
  })

  return (
    <div>
      <p>ä¸»åº”ç”¨çš„æ•°æ®ï¼š{mainAppData ? mainAppData.name : 'æ— '}</p>

      <BrowserRouter basename={window.__MICRO_APP_BASE_ROUTE__ || '/'}>
        <div>
          <header className={styles.header}>
            <Link to="/">react-app Home</Link>
            <Link to="/about">react-app About</Link>
          </header>

          <Routes>
            <Route path="/" element={<Home/>}/>
            <Route path="/about" element={<About/>}/>
          </Routes>
        </div>
      </BrowserRouter>
    </div>
  );
}
```

å­ä¼ çˆ¶æ—¶å¾®åº”ç”¨å‘é€æ•°æ®ä¹Ÿæ˜¯ä¸€è¡Œ `window.microApp.dispatch` å°± OK äº†ï¼Œè€Œä¸”å…¥å‚å¿…é¡»ä¹Ÿä¸ºå¯¹è±¡

```javascript
// react-app App.js
function App() {
  const [mainAppData, setMainAppData] = useState( window.microApp.getData());

  useEffect(() => {
    if (window.microApp) {
      const dataListener = (data) => {
        console.log('ä¸»åº”ç”¨ä¼ çš„æ•°æ®', data);
        setMainAppData(data);
      }

      window.microApp.addDataListener(dataListener)
      return () => {
        window.microApp.clearDataListener()
      }
    }
  })

  // å‘é€æ•°æ®ç»™åŸºåº§
  const sendToMain = () => {
    window.microApp.dispatch({msg: `æˆ‘æ˜¯ react-app éšæœºæ•° ${Math.random()}`})
  }

  return (
    <div>
      <p>ä¸»åº”ç”¨çš„æ•°æ®ï¼š{mainAppData ? mainAppData.name : 'æ— '}</p>

      <button onClick={sendToMain}>ç»™åŸºåº§åº”ç”¨å‘é€</button>

      <BrowserRouter basename={window.__MICRO_APP_BASE_ROUTE__ || '/'}>
        <div>
          <header className={styles.header}>
            <Link to="/">react-app Home</Link>
            <Link to="/about">react-app About</Link>
          </header>

          <Routes>
            <Route path="/" element={<Home/>}/>
            <Route path="/about" element={<About/>}/>
          </Routes>
        </div>
      </BrowserRouter>
    </div>
  );
}
```

åŸºåº§ç›‘å¬çš„æ–¹å¼æœ‰ç‚¹hacky

è™½ç„¶æ²¡æœ‰ç”¨åˆ° `jsxCustomEvent`ï¼Œä½†æ˜¯ä¹Ÿä¸€å®šè¦ import è¿›æ¥ï¼Œä¸”ä¸èƒ½æŠŠæ³¨é‡Šç»™å¹²æ‰ï¼

```javascript
// ReactMicroApp.js
import microApp from '@micro-zoe/micro-app'
import {useState} from "react";
/** @jsxRuntime classic */
/** @jsx jsxCustomEvent */
import jsxCustomEvent from '@micro-zoe/micro-app/polyfill/jsx-custom-event'

const ReactMicroApp = () => {
  const [microAppState, setMicroAppState] = useState(microApp.getData('react-app'));

  const sendReactAppData = () => {
    microApp.setData('react-app', {
      name: `react-app éšæœºæ•°: ${Math.random()}`
    })
  }

  const onDataChange = (e) => {
    console.log('react-app onDataChange', e);
    console.log('react-app æ•°æ®', e.detail.data);
    setMicroAppState(e.detail.data);
  }

  return (
    <div>
      <h1>react-app</h1>
      <button onClick={sendReactAppData}>åŸºåº§ => react-app</button>

      <p>å­åº”ç”¨æ¶ˆæ¯ {microAppState ? microAppState.msg : 'æ— '}</p>

      <micro-app
        name='react-app'
        url='http://localhost:3001/'
        baseroute='/react-app'
        onDataChange={onDataChange}
      >
      </micro-app>
    </div>
  )
}
```

æ¸²æŸ“æ¨¡å¼

- **é»˜è®¤æ¨¡å¼**ï¼šæ¯æ¬¡éƒ½æŒ‰é¡ºåºæ‰§è¡Œä¸€æ¬¡ JSï¼Œå…·æœ‰å¹‚ç­‰æ€§
- **umd æ¨¡å¼**ï¼šåªåœ¨åˆæ¬¡æ¸²æŸ“æ—¶æ‰§è¡Œæ‰€æœ‰ JSï¼Œå¯¹äºéœ€è¦é¢‘ç¹åˆ‡æ¢å¾®åº”ç”¨çš„é¡¹ç›®å¯ä»¥æé«˜å…¶æ€§èƒ½

### å…±äº«é™æ€èµ„æº

ä½¿ç”¨ `globalAssets` å…±äº«èµ„æºï¼š

```javascript

// index.js
import microApp from '@micro-zoe/micro-app'

microApp.start({
  globalAssets: {
    js: ['jsåœ°å€1', 'jsåœ°å€2', ...], // jsåœ°å€
    css: ['cssåœ°å€1', 'cssåœ°å€2', ...], // cssåœ°å€
  }
})
```

æˆ–è€…ä½¿ç”¨globalå±æ€§

```html
<link rel="stylesheet" href="xx.css" global>
<script src="xx.js" global></script>
```

è¿˜æœ‰å¯¹èµ„æºçš„è¿‡æ»¤

```html
<link rel="stylesheet" href="xx.css" exclude>
<script src="xx.js" exclude></script>
<style exclude></style>
```

### ç”Ÿå‘½å‘¨æœŸ

micro appæä¾›äº†ä¸åŒåœ¨å¾®åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸå¯ä»¥æ‰§è¡Œä¸åŒçš„å‘½ä»¤

```javascript
/** @jsxRuntime classic */
/** @jsx jsxCustomEvent */
import jsxCustomEvent from '@micro-zoe/micro-app/polyfill/jsx-custom-event'

const App = () => {
  return (
    <micro-app
      name='xx'
      url='xx'
      onCreated={() => console.log('micro-appå…ƒç´ è¢«åˆ›å»º')}
      onBeforemount={() => console.log('å³å°†è¢«æ¸²æŸ“ï¼Œåªåœ¨åˆå§‹åŒ–æ—¶æ‰§è¡Œä¸€æ¬¡')}
      onMounted={() => console.log('å·²ç»æ¸²æŸ“å®Œæˆï¼Œåªåœ¨åˆå§‹åŒ–æ—¶æ‰§è¡Œä¸€æ¬¡')}
      onAfterhidden={() => console.log('å·²å¸è½½')}
      onBeforeshow={() => console.log('å³å°†é‡æ–°æ¸²æŸ“ï¼Œåˆå§‹åŒ–æ—¶ä¸æ‰§è¡Œ')}
      onAftershow={() => console.log('å·²ç»é‡æ–°æ¸²æŸ“ï¼Œåˆå§‹åŒ–æ—¶ä¸æ‰§è¡Œ')}
      onError={() => console.log('æ¸²æŸ“å‡ºé”™')}
    />
  )
}
```

åº”ç”¨ä¹‹é—´è·³è½¬

- window.history
- é€šè¿‡æ•°æ®é€šä¿¡æ§åˆ¶è·³è½¬
- ä¼ é€’è·¯ç”±å®ä¾‹æ–¹æ³•

éš”ç¦»

JS æ–¹é¢ä½¿ç”¨ `Proxy` æ‹¦æˆªäº†ç”¨æˆ·å…¨å±€æ“ä½œçš„è¡Œä¸ºï¼Œé˜²æ­¢å¯¹ `window` çš„è®¿é—®å’Œä¿®æ”¹ï¼Œé¿å…å…¨å±€å˜é‡æ±¡æŸ“ã€‚

CSS æ–¹é¢æœ‰ä¸¤ç§éš”ç¦»ï¼š

- é»˜è®¤æ·»åŠ  CSS é€‰æ‹©å™¨å‰ç¼€
- ShadowDOM

å…ƒç´ éš”ç¦»æ–¹é¢ï¼Œ`micro-app` æ¨¡æ‹Ÿå®ç°äº†ç±»ä¼¼ `ShadowDom` çš„åŠŸèƒ½ï¼Œå…ƒç´ ä¸ä¼šé€ƒç¦» `<micro-app>` å…ƒç´ è¾¹ç•Œï¼Œå­åº”ç”¨åªèƒ½å¯¹è‡ªèº«çš„å…ƒç´ è¿›è¡Œå¢ã€åˆ ã€æ”¹ã€æŸ¥çš„æ“ä½œã€‚

### å…¶ä»–åŠŸèƒ½

keepAlive

ä¿æŒå¾®åº”ç”¨çš„çŠ¶æ€ `Keep-Alive`

```html
<micro-app name='xx' url='xx' keep-alive></micro-app>
```

prefetch



### micro app vs qiankun

qiankunä¾µå…¥å¼è¾ƒå¼º

## EMP





## servelt

**Svelte**æ˜¯ä¸€ä¸ªç»™æˆ‘åŒæ ·æ„Ÿè§‰çš„JavaScriptæ¡†æ¶ã€‚ä¸Reactï¼ŒVueï¼ŒAngularå’Œå…¶ä»–æ¡†æ¶ç›¸æ¯”ï¼Œä½¿ç”¨Svelteæ„å»ºçš„åº”ç”¨ç¨‹åºæ˜¯**å·²ç¼–è¯‘**ï¼Œä¸å¿…ä¸ºç½‘ç«™è®¿é—®è€…æä¾›æ¡†æ¶å’Œåº“ä»£ç ï¼Œå› æ­¤ï¼Œæ‰€æœ‰ä½“éªŒçš„ç»“æœéƒ½æ›´åŠ æµç•…ï¼Œå ç”¨çš„å¸¦å®½æ›´å°‘ï¼Œå¹¶ä¸”ä¸€åˆ‡æ„Ÿè§‰æ›´å¿«ï¼Œæ›´è½»ä¾¿ã€‚

ä¸Hugoä¸€æ ·ï¼ŒHugoä¼šåœ¨éƒ¨ç½²æ—¶æ¶ˆå¤±å¹¶ç”Ÿæˆçº¯HTMLï¼ŒSvelteä¹Ÿä¼šæ¶ˆå¤±ï¼Œè€Œæ‚¨æ‰€è·å¾—çš„åªæ˜¯çº¯JavaScriptã€‚

Svelte ç”¨äºæ„å»ºå¿«é€Ÿçš„ Web åº”ç”¨ã€‚

Svelte ç±»ä¼¼ React å’Œ Vueï¼Œéƒ½è‡´åŠ›è®©ä½ è½»è€Œæ˜“ä¸¾åœ°æ„å»ºçµæ´»çš„å¯äº¤äº’çš„ç”¨æˆ·ç•Œé¢ã€‚

ä¸å®ƒä»¬æˆªç„¶ä¸åŒçš„æ˜¯ï¼šSvelte åœ¨*æ„å»ºæ—¶* å°†ä½ çš„ä»£ç è½¬ä¸ºæ›´ä¼˜çš„ JavaScriptï¼Œè€Œä¸æ˜¯åœ¨ *è¿è¡Œæ—¶* æ‰è§£é‡Šæ‰§è¡Œä½ çš„ä»£ç ã€‚

è¿™é¢„ç¤ºç€ä½ æ— éœ€ä»˜å‡ºæ¡†æ¶æœ¬èº«çš„æ€§èƒ½æˆæœ¬ï¼Œä¸”é¦–æ¬¡åŠ è½½ä¹Ÿæ— é¢å¤–æ€§èƒ½æŸè€—ã€‚

ä½ å¯ä»¥ä½¿ç”¨ Svelte ç¼–å†™æ•´ä¸ªåº”ç”¨ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥é€æ­¥é‡æ„ç°æœ‰ä»£ç ï¼Œæ•´åŠçš†å¯ï¼›è¿˜å¯ä»¥åªè¾“å‡ºå•ä¸ªç‹¬ç«‹ç»„ä»¶ï¼ˆæ— éœ€å¼ºåˆ¶é™„å¸¦æ¡†æ¶è‡ªèº«ï¼‰å¹¶å°†å…¶ç”¨äºä»»æ„æ¡†æ¶ä¸­ï¼Œå¯è°“ç™¾é¢ç²ç‘ã€‚

å“åº”å¼ä»£ç 

```html
<script>
  let count = 0;
  $: doubled = count * 2;
	
  // åªè¦æ›´æ”¹count çš„å€¼ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨æ§åˆ¶å°è¾“å‡ºå®ƒçš„å€¼
  $: console.log(`the count is ${count}`);

  function handleClick() {
    count += 1;
  }
</script>

<button on:click={handleClick}>
  Clicked {count} {count === 1 ? 'time' : 'times'}
</button>

<p>{count} doubled is {doubled}</p>
```

åœ¨ Svelte ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ `export` å…³é”®å­—æ¥å®ç°æ¥å—çˆ¶ç»„ä»¶ä¼ é€’è¿‡æ¥çš„å±æ€§å€¼ã€‚

ç»„ä»¶çš„å¦ä¸€ä¸ªæ ¸å¿ƒç‚¹æ˜¯ UIï¼Œç”¨äºæè¿° UI çš„ HTML æ˜¯ä¸€ç§â€œé™æ€â€çš„è¯­è¨€ï¼ŒHTML æ˜¯æ— æ³•è¡¨è¾¾ *é€»è¾‘* çš„ï¼Œæ¯”å¦‚æ¡ä»¶å’Œå¾ªç¯ï¼Œä½† Svelte å¯ä»¥ã€‚Svelte ä¸ºå…¶å¢åŠ äº†ä¸€äº›é€»è¾‘æ”¯æŒï¼Œè­¬å¦‚åˆ¤æ–­ã€éå†ç­‰ï¼Œä»¥å¢å¼ºä½ å¯¹ UI çš„è¡¨è¾¾èƒ½åŠ›ã€‚

è¿™äº›é¢å¤–é™„åŠ çš„é€»è¾‘èƒ½åŠ›ä¼¼æ›¾ç›¸è¯†ï¼Œå®ƒååˆ†æ¥è¿‘ä¸€äº›ä»¥å¾€éå¸¸æµè¡Œçš„ [Handlebars](https://link.zhihu.com/?target=https%3A//handlebarsjs.com/) æˆ–è€… [Mustache](https://link.zhihu.com/?target=https%3A//github.com/janl/mustache.js) æ¨¡æ¿è¯­è¨€ï¼Œä¾‹å¦‚` { {&#35;if ...} }`ï¼Œç¨æœ‰åŒºåˆ«çš„æ˜¯ï¼ŒSvelte ä½¿ç”¨å•ä¸ªå¤§æ‹¬å·æ‹¬èµ·ï¼š`{&#35;if ...}`ã€‚

Svelte çš„ç¼–è¯‘å™¨å°†ä¼šç¼–è¯‘è¿™äº›é€»è¾‘ï¼Œé€šè¿‡å°† HTML ç¼–è¯‘æˆä½¿ç”¨åŸç”Ÿ JS åˆ›å»ºçš„å½¢å¼ï¼Œä¹Ÿå³è¿™äº› HTML æœ€ç»ˆå°†ä½¿ç”¨ createElement ç­‰åŸç”Ÿçš„ DOM API æ¥åˆ›å»ºã€‚

è§£é‡Š HTML æ¨¡æ¿æ—¶ï¼ŒSvelte å°±å·²ç»æ˜ç¡®å“ªäº›çŠ¶æ€éœ€è¦æ›´æ–°ã€‚

ifè¯­å¥

```html
<script>
  let user = { loggedIn: false };

  function toggle() {
    user.loggedIn = !user.loggedIn;
  }
</script>

{#if user.loggedIn}
  <button on:click={toggle}>Log out</button>
{:else}
  <button on:click={toggle}>Log in</button>
{/if}
```

eachè¯­å¥

```html
<script>
  let cats = [
    { id: 'J---aiyznGQ', name: 'Keyboard Cat' },
    { id: 'z_AbfPXTKms', name: 'Maru' },
    { id: 'OUtn3pvWmpg', name: 'Henri The Existential Cat' }
  ];
</script>

<h1>The Famous Cats of YouTube</h1>

<ul>
  {#each cats as cat}
    <li>
      <a target="_blank" href="https://www.youtube.com/watch?v={cat.id}">
        {cat.name}
      </a>
    </li>
  {/each}
</ul>
```

å¼‚æ­¥æ•°æ®

```html
<script>
  async function getRandomNumber() {
    const res = await fetch(`https://svelte.dev/tutorial/random-number`);
    const text = await res.text();

    if (res.ok) {
      return text;
    } else {
      throw new Error(text);
    }
  }

  let promise = getRandomNumber();

  function handleClick() {
    promise = getRandomNumber();
  }
</script>

<button on:click={handleClick}>ç”Ÿæˆéšæœºæ•°å­—</button>

{#await promise}
  <p>{promise}</p>
{:then number}
  <!-- è¿”å›çš„ç»“æœä½¿ç”¨ :then å—è¿ç»­æ ‡è®°ï¼Œ
       åé¢æä¾›æ¥æ”¶Promise resolve çš„å˜é‡åç§°
  -->
  <p>The number is {number}</p>
{:catch error}
  <!-- å¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œåœ¨ :catch å­å—ä¸­æ¥æ”¶é”™è¯¯å¯¹è±¡ -->
  <p style="color: red">{error.message}</p>
{/await}

```

### äº‹ä»¶

åªæ‰§è¡Œä¸€æ¬¡

```html
<script>
  function handleClick() {
    alert('no more alerts')
  }
</script>

<button on:click|once={handleClick}>Click me</button>
```

äº‹ä»¶ä¿®é¥°ç¬¦

- `preventDefault`ï¼šåœ¨è¿è¡Œäº‹ä»¶å¤„ç†ç¨‹åºä¹‹å‰å…ˆè°ƒç”¨ `event.preventDefault()` ï¼Œè¿™å¯¹å®¢æˆ·ç«¯åœ¨è¡¨å•å¤„ç†æ—¶å°±å¾ˆæœ‰ç”¨ã€‚
- `stopPropagation`ï¼šè°ƒç”¨ `event.stopPropagation()` åœæ­¢äº‹ä»¶å†’æ³¡ï¼Œé˜²æ­¢äº‹ä»¶ä¼ æ’­åˆ°ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚
- `passive`ï¼šæ”¹è¿›è§¦æ‘¸/æ»šè½®äº‹ä»¶çš„æ»šåŠ¨æ€§èƒ½ï¼ˆSvelte é»˜è®¤ä¼šè‡ªåŠ¨åœ¨å®‰å…¨çš„åœ°æ–¹æ·»åŠ å®ƒï¼‰ã€‚
- `nonpassive`ï¼šæ˜¾å¼è®¾ç½® `passive: false`ã€‚
- `capture`ï¼šåœ¨ *æ•è·* é˜¶æ®µå°±è§¦å‘å¤„ç†ç¨‹åºï¼Œè€Œé *å†’æ³¡* é˜¶æ®µï¼ˆ[å‚é˜… MDN æ–‡æ¡£](https://link.zhihu.com/?target=https%3A//developer.mozilla.org/en-US/docs/Learn/JavaScript/Building_blocks/Events%23Event_bubbling_and_capture)ï¼‰
- `once`ï¼šåœ¨è¿è¡Œä¸€æ¬¡äº‹ä»¶å¤„ç†åï¼Œç«‹å³å°†å…¶ç§»é™¤ã€‚
- `self`ï¼šä»…å½“ event.target æ˜¯å…ƒç´ æœ¬èº«æ—¶æ‰è§¦å‘äº‹ä»¶å¤„ç†ç¨‹åºã€‚

äº‹ä»¶åˆ†å‘

ç»„ä»¶ä¹Ÿå¯ä»¥å‘é€ï¼ˆdispathï¼‰äº‹ä»¶ã€‚ä¸ºæ­¤ï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ªäº‹ä»¶åˆ†å‘å™¨ï¼ˆdispatcherï¼‰ã€‚

ä¸ºäº†å±•ç¤ºç»„ä»¶äº‹ä»¶ï¼Œéœ€è¦å…ˆå†™ä¸€ä¸ªç»„ä»¶

```html
<script>
  import Inner from './Inner.svelte';

  function handleMessage(event) {
    alert(event.detail.text);
  }
</script>

<Inner on:message={handleMessage}/>

<script>
  import { createEventDispatcher } from 'svelte';

  const dispatch = createEventDispatcher();

  function sayHello() {
    dispatch('message', {
      text: 'Hello!'
    });
  }
</script>

<button on:click={sayHello}>Click to say hello</button>
```

this

```svelte
```



### ç”Ÿå‘½å‘¨æœŸ

`onMount` å†å¸¸è§ä¸è¿‡ï¼Œå®ƒåœ¨ç»„ä»¶é¦–æ¬¡æ¸²æŸ“åˆ° DOM åç«‹å³è§¦å‘

è¦åœ¨é”€æ¯ç»„ä»¶æ—¶è¿è¡Œä»£ç ï¼Œè¯·ä½¿ç”¨`onDestroy`ã€‚

`beforeUpdate` å‡½æ•°ä¼šåœ¨ DOM æ›´æ–°ä¹‹å‰æ‰§è¡Œï¼Œè€Œç›¸åº”çš„ `afterUpdate` åˆ™åœ¨æ•°æ®åŒæ­¥åˆ° DOM ä¹‹åæ‰§è¡Œã€‚

`tick` å‡½æ•°ä¸å…¶ä»–ç”Ÿå‘½å‘¨æœŸå‡½æ•°æœ‰æ‰€ä¸åŒï¼Œä¸ä¸€å®šæ˜¯åœ¨é¦–æ¬¡åˆå§‹åŒ–æ—¶è°ƒç”¨ï¼Œä½ å¯ä»¥éšæ—¶è°ƒç”¨å®ƒã€‚å®ƒè¿”å›ä¸€ä¸ª Promiseï¼Œå¹¶ resolve ä»»ä½•æŒ‚èµ·çš„çŠ¶æ€ï¼ˆå¦‚æœæ²¡æœ‰å°±ç«‹å³ resolveï¼‰ã€‚

åœ¨ Svelte ä¸­ï¼Œå½“ä½ æ›´æ–°ç»„ä»¶çŠ¶æ€æ—¶ï¼Œå®ƒä¸ä¼šç«‹å³æ›´æ–° DOMã€‚ç›¸åï¼Œå®ƒä¼šç­‰åˆ°ä¸‹ä¸€ä¸ª *å¾®ä»»åŠ¡* æ—¶æ›´æ–°ï¼ŒæœŸé—´æŸ¥çœ‹æ˜¯å¦éœ€è¦åº”ç”¨å…¶ä»–çš„æ›´æ”¹ï¼ŒåŒ…æ‹¬å…¶ä»–ç»„ä»¶çš„æ›´æ”¹ã€‚è¿™æ ·åšå¯ä»¥å‡å°‘ä¸€äº›æ— ç”¨åŠŸï¼Œè®©æµè§ˆå™¨æ›´æœ‰æ•ˆåœ°æ‰¹é‡å¤„ç†è¿™äº›äº‹æƒ…ã€‚



### çŠ¶æ€ç®¡ç†

Svelte æ˜¯æ²¡æœ‰å¯¹åº”çš„çŠ¶æ€åº“çš„ï¼Œå› ä¸ºå®ƒå†…ç½®äº†çŠ¶æ€ç®¡ç†ï¼Œå®ƒè¢«ç§°ä¸º `store`ã€‚

å½“æœŸæœ›è„±ç¦»ç»„ä»¶çš„å±‚çº§ï¼ˆçˆ¶-å­ï¼‰å…³ç³»ä¸”èƒ½å¤Ÿåœ¨ä»»æ„ä½ç½®éƒ½èƒ½è®¿é—®æŸä¸ªçŠ¶æ€ï¼ˆå˜é‡ï¼‰æ—¶ï¼ŒçŠ¶æ€ç®¡ç†ä»ç„¶æ˜¯éå¸¸æœ‰ç”¨çš„ä¸€ä¸ªç‰¹æ€§ã€‚

å¹¶éæ‰€æœ‰çš„çŠ¶æ€éƒ½å±äºåœ¨ç»„ä»¶å±‚æ¬¡çš„ç»“æ„å†…ã€‚æŸäº›æ—¶å€™ï¼Œæœ‰äº›çŠ¶æ€éœ€è¦è¢«å¤šä¸ªæ¯«ä¸ç›¸å¹²çš„ç»„ä»¶æˆ–æ™®é€šçš„ JavaScript æ¨¡å—è®¿é—®ã€‚

åœ¨ Svelte ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡*store*æ¥å®ç°ã€‚

Svelte å°†çŠ¶æ€åˆ’åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§`å¯è¯»å¯å†™`ï¼Œä¸€ç§`åªè¯»`ï¼Œéƒ½ç”¨`å¯è¯»å¯å†™`ï¼ˆå¯ä»¥è¯»å–ï¼Œä¹Ÿå¯ä»¥ä¿®æ”¹ï¼‰è™½ç„¶çœäº‹ï¼Œä¸è¿‡å…è®¸æˆ–è€…è¯´å¼ºåˆ¶çŠ¶æ€æ˜¯åªè¯»çš„ï¼Œå¯ä»¥é˜²æ­¢çŠ¶æ€è¢«æ„å¤–ä¿®æ”¹ã€‚

æ‰€è°“ storeï¼ˆä¹Ÿå³çŠ¶æ€ï¼‰ï¼Œåªä¸è¿‡æ˜¯å…·æœ‰ `subscribe` æ–¹æ³•çš„å¯¹è±¡ï¼Œå®ƒå…è®¸å½“ store çš„å€¼æ”¹å˜æ—¶è‡ªåŠ¨é€šçŸ¥å¯¹æ­¤æ„Ÿå…´è¶£çš„ç›¸å…³ç»„ä»¶æˆ–ç¨‹åºã€‚åœ¨ `App.svelte` ä¸­ï¼Œ`count` ä¾¿æ˜¯ä¸€ä¸ª storeï¼Œæˆ‘ä»¬åœ¨ `count.subscribe` çš„å›è°ƒä¸­è®¾ç½® `count_value` çš„å€¼ã€‚

Svelte å‡å®šæ‰€æœ‰ä»¥ `$` å¼€å¤´çš„ä»»ä½•æ ‡è¯†ç¬¦éƒ½è¡¨ç¤ºå¼•ç”¨æŸä¸ª store å€¼ï¼Œè€Œ `$` å®é™…ä¸Šæ˜¯ä¸€ä¸ªä¿ç•™å­—ç¬¦ï¼ŒSvelte ä¼šç¦æ­¢ä½ ä½¿ç”¨ `$` ä½œä¸ºä½ å£°æ˜çš„å˜é‡çš„å‰ç¼€ã€‚

```html
<script>
  import { count } from './stores.js';
  import Incrementer from './Incrementer.svelte';
  import Decrementer from './Decrementer.svelte';
  import Reset from './Reset.svelte';
</script>

<h1>count å½“å‰çš„å€¼æ˜¯ï¼š{$count}</h1>
```

å¹¶éæ‰€æœ‰ store å…è®¸æ‰€æœ‰äºº*å¯å†™*çš„ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½æœ‰ä¸€ä¸ª store è¡¨ç¤ºé¼ æ ‡ä½ç½®æˆ–è€…ç”¨æˆ·åœ°ç†ä½ç½®ï¼Œå…è®¸ â€˜å¤–éƒ¨â€™ æ¥ä¿®æ”¹è¿™ä¸ªå€¼æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚å¯¹äºè¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥ç”¨*åªè¯»*storeã€‚

åªè¯»çŠ¶æ€

å¹¶éæ‰€æœ‰ store å…è®¸æ‰€æœ‰äºº*å¯å†™*çš„ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½æœ‰ä¸€ä¸ª store è¡¨ç¤ºé¼ æ ‡ä½ç½®æˆ–è€…ç”¨æˆ·åœ°ç†ä½ç½®ï¼Œå…è®¸ â€˜å¤–éƒ¨â€™ æ¥ä¿®æ”¹è¿™ä¸ªå€¼æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚å¯¹äºè¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥ç”¨*åªè¯»*storeã€‚

```javascript
import { readable } from 'svelte/store';

export const time = readable(new Date(), function start(set) {
  const interval = setInterval(() => set(new Date()), 1000);

  return function stop() { clearInterval(interval); };
});
```

`readable` çš„ç¬¬ä¸€ä¸ªå‚æ•°ä»£è¡¨åˆå§‹å€¼ï¼Œå¦‚æœè¿˜æ²¡æœ‰å…·ä½“çš„åˆå§‹å€¼ï¼Œå¯ä»¥å…ˆè®¾ä¸º `null` æˆ– `undefined`ã€‚

ç¬¬äºŒä¸ªå‚æ•° `start` æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥å—ä¸€ä¸ª `set` å›è°ƒç”¨äºè®¾ç½®å€¼ï¼Œå¹¶ä¸”è¿”å›ä¸€ä¸ª `stop` å‡½æ•°ã€‚

å½“ store è¢«ç¬¬ä¸€ä¸ªè®¢é˜…è€…è¯»å–æ—¶ï¼Œå°±ä¼šè°ƒç”¨ `start` å‡½æ•°ï¼ˆç„¶ååœ¨ `start` å‡½æ•°ä¸­ä½¿ç”¨ `set` æä¾›ä¸€ä¸ªæœ€ç»ˆçš„å€¼ï¼›

æœ€åä¸€ä¸ªè®¢é˜…è€…é€€è®¢æ—¶ï¼Œè°ƒç”¨ `stop` å‡½æ•°ã€‚

çŠ¶æ€ç»§æ‰¿

`derived`æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ storeï¼Œå®ƒå°†ç»§æ‰¿è‡ªæŸä¸€ä¸ªæˆ–å¤šä¸ª*å…¶ä»–*çš„ storeã€‚

```javascript
import { readable, derived } from 'svelte/store';

export const time = readable(new Date(), function start(set) {
  const interval = setInterval(() => {set(new Date()), 1000);

  return function stop() { clearInterval(interval); };
});

const start = new Date();
  
export const elapsed = derived(
  time,
  $time => Math.round(($time - start) / 1000)
);
```

å¯ä»å¤šä¸ª store æ´¾ç”Ÿä¸ºä¸€ä¸ª storeï¼Œå¹¶æ˜¾å¼åœ° `set` ä¸€ä¸ªå€¼è€Œä¸æ˜¯è¿”å›å®ƒï¼ˆè¿™å¯¹äºå¼‚æ­¥æ´¾ç”Ÿçš„å€¼å¾ˆæœ‰ç”¨å¤„ï¼‰ã€‚

è‡ªå®šä¹‰store store.js

```javascript
import { writable } from 'svelte/store';

function createCount() {
  const { subscribe, set, update } = writable(0);

  return {
    subscribe,
    increment: () => update(n => n + 1),
    decrement: () => update(n => n - 1),
    reset: () => set(0)
  };
}

export const count = createCount();
```

å¼•å…¥storeä¸­çš„çŠ¶æ€

```html
<script>
  import { count } from './stores.js';
</script>

<h1>count çš„å½“å‰å€¼æ˜¯ï¼š{$count}</h1>

<button on:click={count.increment}>+</button>
<button on:click={count.decrement}>-</button>
<button on:click={count.reset}>reset</button>
```

ç”¨RXJSæ›¿ä»£store

è¦è·å¾— `store` çš„å€¼ï¼Œæ˜¯é€šè¿‡ `store.subscribe` æ–¹æ³•å»è®¢é˜…ï¼Œstore äº§ç”Ÿçš„å€¼ä¼šè‡ªåŠ¨æ¨é€ç»™è®¢é˜…è€…ï¼Œè¿™ç‚¹ä¸ RxJS å¦‚å‡ºä¸€è¾™ï¼Œå®é™…ä¸Šï¼Œä½ å¯ä»¥å°† Svelte çš„ `store` çœ‹ä½œæ˜¯ RxJS çš„ `Observable`ã€‚

è¿™æ ·åšä¸æ˜¯æ²¡æœ‰åŸå› çš„ï¼Œå…¶ä¸€æ˜¯ä¸ºäº†æ›´å®¹æ˜“ä¸ç±»ä¼¼ rxjs è¿™æ ·çš„åº“ç›¸ç»“åˆï¼Œå…±åŒå‘æŒ¥ä½œç”¨ï¼›å…¶äºŒæ˜¯è®¤åŒ RxJS è¿™å¥—è§‚å¯Ÿè€…-è®¢é˜…çš„ç†å¿µä¸”å€¼å¾—å€Ÿé‰´ã€‚

```html
<script>
  import { fromEvent } from 'rxjs'
  import { map } from 'rxjs/operators'
	
  let position = fromEvent(document, 'mousemove')
	         .pipe(map(e => `é¼ æ ‡ä½ç½®: ${e.clientX},${e.clientY}`))
</script>

{$position}
```



### åŠ¨ç”»

Svelte æ”¯æŒä¸¤ç§è¿åŠ¨æ•ˆæœï¼Œä¸€ç§æ˜¯è¡¥é—´åŠ¨ç”»æ•ˆæœ `tweened`ï¼Œå¦ä¸€ç§æ˜¯å¼¹ç°§æ•ˆæœ `spring`ã€‚è¿™ä¸¤ç§æ•ˆæœåœ¨é¡µé¢ä¸­éƒ½ååˆ†å¸¸è§ï¼Œå› æ­¤ Svelte å†…ç½®æ”¯æŒå®ƒä»¬ã€‚

è¿‡æ¸¡æ•ˆæœæ›´æ˜¯é¡µé¢åŠ¨ç”»çš„é‡å¤´æˆï¼Œç”±äºååˆ†å¸¸ç”¨ï¼ŒSvelte ä¸ºè¿‡æ¸¡åŠ¨ç”»æ•ˆæœä¸“é—¨åˆ›å»ºäº†æŒ‡ä»¤çº§åˆ«çš„æ”¯æŒï¼Œåˆ†åˆ«æ˜¯ `transition`ã€`in`ã€`out`ï¼Œå®ƒä»¬éƒ½æ”¯æŒè®¾ç½®é™„åŠ å‚æ•°ï¼Œä¾‹å¦‚ `duration` ç”¨äºè®¾ç½®åŠ¨ç”»è¿åŠ¨çš„æ€»æ—¶é•¿ã€‚`transition` æ˜¯å°†è¿›å…¥è¿‡æ¸¡å’Œé€€å‡ºè¿‡æ¸¡ä¸¤è€…é½é›†ä¸€èº«

Svelte æ— æ³•ä¸ºå„ç§å„æ ·çš„åŠ¨ç”»æä¾›é¢„è®¾æ”¯æŒï¼Œå› æ­¤å¦‚æœæŸäº›æ•ˆæœç‰¹åˆ«å¼•äººå…¥èƒœï¼Œä½ å¯ä»¥é€šè¿‡è‡ªå®šä¹‰ CSS è¿‡æ¸¡æ•ˆæœæ¥åŒ…è£…å®ƒä»¬ï¼Œæœ‰äº›è¿˜éœ€è¦é…åˆ JS åˆ›å»ºçš„æ•ˆæœï¼ŒSvelte ä¹Ÿæ˜¯æ”¯æŒçš„ã€‚

å±€éƒ¨è¿‡æ¸¡å…¶å®æ˜¯å°†åŠ¨ç”»æ•ˆæœé™åˆ¶åªåº”ç”¨åœ¨å…ƒç´ æ·»åŠ æˆ–åˆ é™¤æ—¶æ‰è§¦å‘ï¼Œè€Œåœ¨é¦–æ¬¡åˆ›å»ºæ—¶å…ƒç´ ä¸ä¼šè¢«æ‰§è¡ŒåŠ¨ç”»æ•ˆæœã€‚

å»¶è¿Ÿè¿‡æ¸¡ç»å¸¸ç”¨äºä¾‹å¦‚ç©¿æ¢­æ¡†ä¹‹ç±»çš„ç»„ä»¶ä¸­ï¼Œå®ƒå¯ä»¥å®ç°æé«˜ç”¨æˆ·ä½“éªŒçš„äº¤äº’ã€‚è¿™ç§æ•ˆæœé€šå¸¸ä¼šæœ‰ä¸€ä¸ª`å‘é€ç«¯`ï¼ˆsendï¼‰å’Œ`æ¥æ”¶ç«¯`ï¼ˆreceiveï¼‰ï¼Œä¾‹å¦‚ `crossfade` æ•ˆæœã€‚



### åŠ¨ä½œ

`action` åŒæ ·æ˜¯ä¸€ç§ä¸ºç»„ä»¶å¢å¼ºèƒ½åŠ›çš„ç‰¹æ€§

`action` ä¸bindï¼šthisä¸åŒçš„æ˜¯ï¼Œå®ƒæœ‰æ›´å¼ºçš„å°è£…æ€§å’Œå¤ç”¨æ€§ï¼Œå°†é€»è¾‘ä»£ç æ‹†åˆ†åˆ° JS æ–‡ä»¶ä¸­ä¾›åå¤åº”ç”¨ã€‚

```html
<script>
export function longpress(node, duration) {
  let timer;
	
  const handleMousedown = () => {
    timer = setTimeout(() => {
      node.dispatchEvent(
        new CustomEvent('longpress')
      );
    }, duration * 1000);
  };
	
  const handleMouseup = () => clearTimeout(timer);

  node.addEventListener('mousedown', handleMousedown);
  node.addEventListener('mouseup', handleMouseup);

  return {
    destroy() {
      node.removeEventListener('mousedown', handleMousedown);
      node.removeEventListener('mouseup', handleMouseup);
    }
  };
}
</script>

<button
  use:longpress={duration}
  ...
>æŒ‰ä½æˆ‘åˆ«æ”¾</button>
```



### æ ·å¼



### æ’æ§½

HTML å…ƒç´ å…è®¸ç›¸äº’ç»„åˆï¼Œç”±æ­¤æ„å»ºå¤æ‚çš„é¡µé¢ã€‚

å¦‚æœä¸æ˜¯æ™®é€šçš„ HTML å…ƒç´ ï¼Œè€Œæ˜¯ Svelte ç»„ä»¶ï¼ŒåŒæ ·æ”¯æŒè®©ç»„ä»¶ä½œä¸ºå®¹å™¨ï¼Œä¸ºå…¶æ·»åŠ å­ç»„ä»¶ï¼Œä»¥æ­¤ç»„åˆå‡ºæ›´å¤§æ›´å¼ºçš„ç»„ä»¶ï¼Œè¿™ç§å®¹å™¨è¢«ç§°ä¸º `æ’æ§½`ï¼ˆSlotsï¼‰ã€‚

ç»„ä»¶å¯ä»¥æŒ‡å®š`<slot>`å…ƒç´ å½“å†…å®¹ä¸ºç©ºçš„*ç¼ºçœ*æƒ…å†µåº”è¯¥é»˜è®¤æ˜¾ç¤ºä»€ä¹ˆå†…å®¹ï¼š

æˆ‘ä»¬åŒ…å«äº†ä¸€ä¸ª*é»˜è®¤æ’æ§½*ï¼Œç”¨äºç›´æ¥ä»£æ›¿ç»„ä»¶çš„å­èŠ‚ç‚¹ã€‚ä¸è¿‡æœ‰äº›æ—¶å€™ï¼Œä½ éœ€è¦å¯¹æ”¾ç½®çš„å†…å®¹æœ‰æ›´å¤šçš„æ§åˆ¶èƒ½åŠ›ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ *å‘½åæ’æ§½* ï¼š

```html
// box.svelte
<div class="box">
  <h3>
    <slot name="name">Unknown name</slot>
  </h3>

  <div>
    <slot name="address">Unknown address</slot>
  </div>
</div>

// app.svelte
<Box>
  <h2>Hello!</h2>
  <p>This is a box. It can contain anything.</p>
  <span slot="name">P. Sherman</span>
  <span slot="address">42 Wallaby Way Sydney</span>
</Box>

<Box />
```

å¯ä»¥ç¼–å†™ä¸€ä¸ª`if`å—ï¼Œå—çš„èŒƒå›´åŒ…æ‹¬äº†`comments`è¯„è®ºæ’æ§½ä»¥åŠæ’æ§½æ‰€åœ¨çš„æ•´ä¸ª`<div>`ï¼Œåœ¨`if`å—ä¸­éœ€è¦æ£€æµ‹`$$slots`ä¸­çš„`comments`æ’æ§½æ˜¯å¦å­˜åœ¨å†…å®¹ï¼š

```html
<script>
  export let title = ''
</script>

<article>
  <h2>{title}</h2>
  <hr />
  <div><slot name="content" /></div>

  {#if $$slots.comments}
  <div style="margin-top: 30px;">
    è¯„è®º:
    <slot name="comments" />
  </div>
  {/if}

</article>
```



### ä¸Šä¸‹æ–‡

ç»„ä»¶ Contextï¼ˆä¸Šä¸‹æ–‡ï¼‰ API ä¸ºç»„ä»¶æä¾›ä¸€ç§å½¼æ­¤ 'å¯¹è¯' æœºåˆ¶ï¼Œè€Œæ— éœ€å°†æ•°æ®å’Œå‡½æ•°ä½œä¸ºå±æ€§æ¥ä¼ é€’ï¼Œæˆ–è€…å‘é€å¤§é‡çš„äº‹ä»¶ã€‚

Context ç›¸å…³çš„ API å‡½æ•°æœ‰ä¸¤ä¸ªï¼Œåˆ†åˆ«æ˜¯`setContext`å’Œ`getContext`ã€‚

å¦‚æœç»„ä»¶è°ƒç”¨äº†`setContext(key, context)`ï¼Œé‚£ä¹ˆå…¶ä»»æ„çš„***å­ç»„ä»¶*** éƒ½å¯ä»¥é€šè¿‡`const context = getContext(key)`æ¥è·å–è¿™ä¸ª contextã€‚

Svelte å¯¹æ¯” React ç¨å¾®è¦ç®€å•ç›´è§‚ä¸€äº›ï¼ŒæŠ›å´äº† Provider å’Œ Consumer çš„æ¦‚å¿µï¼Œäº‹å®ä¸Šç®€å•äº›å°±å¾ˆå¥½ï¼Œå°±æƒ³ç»„ä»¶é—´å…±äº«ç‚¹æ•°æ®ç½¢äº†ï¼Œæ²¡å¿…è¦æœ‰æ¿æœ‰çœ¼åˆ›é€ ä¸€äº›é«˜çº§éšå–»ï¼Œè®©å…¶æ¼‚æŸ“æµ“åšçš„`è®¾è®¡`æ°”æ¯ã€‚

æ¨¡å—ä¸Šä¸‹æ–‡çš„ä¸»è¦ç”¨é€”ï¼Œæ˜¯æä¾›ä¸€ç§æ–¹æ³•ï¼Œè®©æŸä¸ªç»„ä»¶çš„æ‰€æœ‰å®ä¾‹éƒ½å…±äº«åŒä¸€ä¸ªä¸Šä¸‹æ–‡ï¼ˆè¿™å…¶å®ç”¨ store ä¹Ÿå®Œå…¨èƒ½å®ç°åŒç­‰åŠŸèƒ½ï¼Œåªä¸è¿‡æ¨¡å—ä¸Šä¸‹æ–‡æ›´æ˜¾å¾—å…³è”æ€§é«˜ä¸€äº›ï¼Œä»¥åŠå°è£…æ€§å¼ºä¸€äº›ï¼‰ã€‚



### ç‰¹æ®Šå…ƒç´ 

Svelte æä¾›äº†å„ç§å†…ç½®çš„ç‰¹æ®Šå…ƒç´ ã€‚

`<svelte:self>`ï¼Œå®ƒè¡¨ç¤ºå½“å‰ç»„ä»¶ï¼Œå…è®¸åœ¨æŸäº›æƒ…å†µé€’å½’è‡ªèº«ï¼Œè¿™å¯¹äºå±•ç¤ºæ–‡ä»¶å¤¹æ ‘ä¹‹ç±»çš„è§†å›¾å¾ˆæœ‰ç”¨ï¼Œå…¶ä¸­æ–‡ä»¶å¤¹å¯ä»¥åŒ…å« *å…¶ä»–* æ–‡ä»¶å¤¹ã€‚

```html
{#each folders as f}
  <li>
    <svelte:self {...f} />
  </li>
{/each}
```

ç»„ä»¶å¯ä»¥é€šè¿‡`<svelte:component>`è¿›è¡Œ â€œå˜èº«â€ï¼Œè¿™æ ·å¯ä»¥çœæ‰ä¸€ç³»åˆ—çš„`if`å—

```html
<script>
  import Red from './Red.svelte';
  import Green from './Green.svelte';
  import Blue from './Blue.svelte';

  let selected = '0';
  $: component = [Red, Green, Blue][selected]
</script>

<select bind:value={selected}>
  <option value="0">çº¢</option>
  <option value="1">ç»¿</option>
  <option value="2">è“</option>
</select>

<svelte:component this={component} />
```

æ­£å¦‚ä»»ä½• DOM å…ƒç´ éƒ½å¯ä»¥å°†ç›‘å¬äº‹ä»¶ä¸€æ ·ï¼Œä½ å¯ä»¥é€šè¿‡`<svelte:window>`æ¥ç›‘å¬`window`å¯¹è±¡çš„äº‹ä»¶ï¼Œä¾‹å¦‚é¼ æ ‡ç§»åŠ¨çš„äº‹ä»¶ï¼š

```html
<script>
  let x, y
</script>

<svelte:window on:mousemove={ e => ({x, y} = e) } />

<p>é¼ æ ‡ä½ç½®ï¼š{x}, {y}</p>
```

æˆ‘ä»¬è¿˜å¯ä»¥ç»‘å®šä¸€äº›`window`çš„å±æ€§ï¼ŒæŸäº›ä¸šåŠ¡æˆ‘ä»¬å¯èƒ½éœ€è¦ç›‘æµ‹æµè§ˆå™¨çª—å£çš„å¤§å°ï¼ŒåŸç”Ÿçš„å†™æ³•

æ˜¯é€šè¿‡ç›‘å¬ `window.onresize` æ¥å®ç°çš„ã€‚

åœ¨ Svelte ä¸­ï¼Œå®ƒæ›´ä¸ºç®€å•ï¼Œå¹¶ä¸”æ”¯æŒç»‘å®š

```html
<script>
  let width, height
</script>

<svelte:window bind:innerWidth={width} bind:innerHeight={height} />

<p>Window Size: width={width}, height={height}</p>
```

æ”¯æŒç»‘å®šçš„å±æ€§åˆ—è¡¨å¦‚ä¸‹ï¼š

- `innerWidth` - è·å¾—æµè§ˆå™¨çª—å£çš„å†…å®¹åŒºåŸŸçš„å®½åº¦ï¼ŒåŒ…å«å‚ç›´æ»šåŠ¨æ¡(å¦‚æœæœ‰çš„è¯)
- `innerHeight` - è·å¾—æµè§ˆå™¨çª—å£çš„å†…å®¹åŒºåŸŸçš„é«˜åº¦ï¼ŒåŒ…å«æ°´å¹³æ»šåŠ¨æ¡(å¦‚æœæœ‰çš„è¯)
- `outerWidth` - è·å¾—æµè§ˆå™¨çª—å£çš„å®½åº¦
- `outerHeight` - è·å¾—æµè§ˆå™¨çª—å£çš„é«˜åº¦
- `scrollX` - document åœ¨æ°´å¹³æ–¹å‘å·²æ»šåŠ¨çš„åƒç´ å€¼
- `scrollY` - document åœ¨å‚ç›´æ–¹å‘å·²æ»šåŠ¨çš„åƒç´ å€¼
- `online` - `window.navigator.onLine` çš„åˆ«åï¼Œä»£è¡¨å½“æµè§ˆå™¨èƒ½å¤Ÿè®¿é—®ç½‘ç»œã€‚

`<svelte:body>`å…ƒç´ å…è®¸ä½ ç›‘å¬`document.body`ä¸Šçš„äº‹ä»¶ã€‚è¿™å¯¹äº`mouseenter`å’Œ`mouseleave`äº‹ä»¶æ¥è¯´ååˆ†æœ‰ç”¨ï¼Œå®ƒä»¬æ— æ³•åœ¨`window`ä¸Šè§¦å‘ã€‚

```html
<script>
  let msg = ''
</script>

<svelte:body
  on:mouseenter={() => msg = 'Enter'}
  on:mouseleave={() => msg = 'Leave'}
/>

<div>{msg}</div>
```

`<svelte:head>`å…ƒç´ å…è®¸ä½ å°†å…¶ä»–å…ƒç´ æ’å…¥åˆ°æ–‡æ¡£ä¸­çš„`<head>`ä¸­ï¼š

`<head>` ä¸­å¯ä»¥æ’å…¥ä¾‹å¦‚ `<script>`ã€`<link>`ã€`<title>` å’Œ `<meta>` ç­‰ç­‰å…ƒç´ ï¼š

```html
<svelte:head>
  <link rel="stylesheet" href="./global.css">
</svelte:head>
```

åœ¨æœåŠ¡å™¨ç«¯æ¸²æŸ“ (SSR) æ¨¡å¼ä¸‹ï¼Œ`<svelte:head>` çš„å†…å®¹ä¸ HTML çš„å…¶ä½™éƒ¨åˆ†æ˜¯åˆ†åˆ«è¿”å›çš„ã€‚

`<svelte:fragment>`å®ç°ç±»ä¼¼æ’æ§½çš„åŠŸèƒ½ã€‚

```html
<script>
  import Material from './Material.svelte'
</script>

<Material>
  <svelte:fragment slot="bottom">
    <li>é«˜ç­‹é¢ç²‰</li>
    <li>ä½ç­‹é¢ç²‰</li>
  </svelte:fragment>
</Material>
```

`<svelte:options>`å…è®¸ä½ é…ç½®ç¼–è¯‘å™¨çš„é€‰é¡¹ã€‚æ¯”å¦‚å¸Œæœ›ä¸ºç»„ä»¶çš„å˜é‡ç”Ÿæˆå±æ€§è®¿é—®å™¨ï¼ˆé»˜è®¤ä¸ç”Ÿæˆï¼‰ã€‚ç”Ÿæˆå±æ€§è®¿é—®å™¨çš„ç›®çš„ï¼Œæ˜¯æä¾›ç»™ä½¿ç”¨ç«¯æ›´å®¹æ˜“å»è®¿é—®çš„ï¼Œè¿™é€šå¸¸æ˜¯ä½ ç¼–å†™äº†ä¸€ä¸ª Svelte ç»„ä»¶ï¼Œæƒ³åŒæ—¶åœ¨ React æˆ–è€… Vue ç­‰åœ°æ–¹ä¸Šç”¨æ—¶æ‰éœ€è¦è¿™ä¸ªé€‰é¡¹ã€‚

```html
<script>
  export let x = 'hello'
</script>

<svelte:options accessors />

<p>{x}</p>
```

ä¸‹åˆ—æ˜¯å…è®¸åœ¨æ­¤å¤„è®¾ç½®å¯é€‰ç”¨çš„å€¼ï¼š

- `immutable={true}`ï¼šä½ ç¡®ä¿¡ä¸ä¼šä½¿ç”¨å¯å˜æ•°æ®ï¼Œå› æ­¤ç¼–è¯‘å™¨å¯ä»¥æ‰§è¡Œç®€å•çš„å¼•ç”¨ç›¸ç­‰æ€§æ£€æŸ¥æ¥ç¡®å®šå€¼æ˜¯å¦å·²æ›´æ”¹ã€‚
- `immutable={false}`ï¼šé»˜è®¤å€¼ï¼ŒSvelte å°†æŒ‰é»˜è®¤çš„æ–¹å¼å¤„ç†å¯å˜å¯¹è±¡çš„æ›´æ”¹
- `accessors={true}`ï¼šä¸ºç»„ä»¶çš„ props æ·»åŠ  getter å’Œ setter
- `accessors={false}`ï¼šé»˜è®¤å€¼
- `namespace="..."`ï¼šå°†ä½¿ç”¨æ­¤ç»„ä»¶çš„å‘½åç©ºé—´ï¼Œæœ€å¸¸è§çš„å°±æ˜¯ `"svg"`
- `tag="..."`ï¼šå°†ç»„ä»¶ç¼–è¯‘ä¸ºè‡ªå®šä¹‰å…ƒç´ æ—¶ï¼ŒæŒ‡å®šçš„æ ‡ç­¾åç§°

### Svelte Kit

æ­£å¦‚ React ä¹‹äº [Next](https://nextjs.org/)ï¼ŒSvelte å¯¹åº”çš„ Web æ¡†æ¶ä¾¿æ˜¯ SvelteKitã€‚

å®ƒæ˜¯ä¸€ä¸ªç”¨ Svelte æ„å»ºåº”ç”¨çš„æ¡†æ¶ï¼ŒåŒ…æ‹¬æœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰ã€è·¯ç”±ã€é’ˆå¯¹ JS å’Œ CSS çš„ä»£ç åˆ†å‰²ï¼Œä»¥åŠé’ˆå¯¹ä¸åŒ Serverless å¹³å°ç”Ÿæˆä¸åŒä»£ç çš„é€‚é…å™¨ç­‰ç­‰ã€‚



